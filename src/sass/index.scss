// @use 'reset';
// @use 'assets';

// @use '../mixins/vars' as *;
// @use 'utilities/vars' as *;

// :root { @include vars($css); }

// @use 'common';
// @use 'blocks';
// @use 'sections';
// @use 'pages';

@use 'utilities/modules/obj';
@use 'utilities/modules/fn';
@use 'utilities/modules/placeholder';
@use 'utilities/modules/ports';
@use 'sass:string';
@use 'sass:meta';

@function p($name: 'default') {
  @return placeholder.create($name);
}

@function f($str, $args...) {
  $module: fn.get-module-name($str);
  $fn: fn.get-function-name($str);
  $port: fn.get-port-name($str);
  $args: fn.arglist-to-list($args);

  $fn-exists: if(
    $module,
    map-has-key(meta.module-functions($module), $fn),
    function-exists($fn)
  );

  @if not $fn-exists { @error 'No such function: "#{$fn}"'; }
  
  @return fn.create(get-function($fn, $module: $module), $port, $args);
}

@function invoke($fns...) {
  $ports: ports.reset();
  $result: fn.invoke-fn-list(fn.arglist-to-list($fns));
  $ports: ports.reset();
  @return $result;
}


@function get-str() {
  @return 'fuck you';
}

@function add($a, $b) {
  @return $a + $b;
}

@function decrement($num) {
  @return $num - 1;
}

@function increment($num) {
  @return $num + 1;
}

@debug invoke(
  f('string.slice', 
    (
      f('get-str'),
      f('string.index:i', p(), ' '),
      f('string.slice', p(), 1, p('i')),
    ),
    1,
    (
      f('add', 1, 1),
      f('increment', p()),
      f('increment', p()),
      f('decrement', p()),
    )
  ) 
);

